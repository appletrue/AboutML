
# 全概率公式 total probability:

From Wiki & Blogs

### 条件概率公式:

设A,B是两个事件，且P(B)>0,则在事件B发生的条件下，事件A发生的条件概率（conditional probability)为：

P(A|B)=P(AB)/P(B)

----条件概率及公式-------

在离散情况下，上述公式等于下面这个公式。但后者在连续情况下仍然成立：

$Pr(A)=E(Pr(A\mid N))$ (N是任意随机变量)。

这个公式还可以表达为:"A的先验概率等于A的后验概率的先验期望值。

-----

假设{ Bn : n = 1, 2, 3, ... } 是一个概率空间的有限或者可数无限的分割（既 Bn为一完备事件组），且每个集合Bn是一个可测集合，则对任意事件A有全概率公式：

$ Pr(A)=\sum_{n} Pr(A \cap B_{n})$,又因为

$Pr(A\cap B_{n})=Pr(A\mid B_{n})Pr(B_{n})$,此处Pr(A|B)是B发生后A的条件概率，所以**全概率公式**又可写作：

$Pr(A)=sum _{n}Pr(A\mid B_{n})Pr(B_{n})$,

全概率公式将对一复杂事件A的概率求解问题转化为了在不同情况或不同原因 Bn下发生的简单事件的概率的求和问题。

![totalpro](https://github.com/appletrue/NoteML/blob/master/PICs/totalpro.png)

全概率公式可以从另一个角度去理解，把Bn看作是事件A发生的一种“**可能途径**”，若采用了不同的途径，A发生的概率，也就是相应的条件概率P(A|Bn)也会不同。但是，我们事先却并不知道将会走哪条途径，换言之，**途径的选择是随机的**，这样就导致了**不同途径被选中的可能性也许也会存在差异**，这就是P(Bn)所表达的含义。这样一来，我们最终所要求的P(A)，实际上就是一个**不同路径概率的加权平均**。

![totalpro2](https://github.com/appletrue/NoteML/blob/master/PICs/totalpro2.png)

（1）加法公式：P(A+B) = P(A) + P(B) - P(AB)

（2）减法公式：P(A-B) = P(A) - P(AB)

（3）乘法公式：P(AB) = P(A)*P(B|A)

### 乘法公式的推广：

对于任何正整数n≥2，当$P(A_1A_2...A_{n-1}) > 0$ 时，有：

$P(A_1A_2...A_{n-1}A_n)=P(A_1)P(A_2|A_1)P(A_3|A_1A_2)...P(A_n|A_1A_2...A_{n-1})$

（4）全概率公式 $P(A) = P(B_1)*P(A|B_1) + P(B_2)*P(A|B_2) + ........$

### 全概率公式应用：

例：

一批产品共8件，其中正品6件，次品2件．现不放回地从中取产品两次，每次一件，求第二次取得正品的概率．

题解：有两种写法，第一种是用组合公式，算出取的总可能，再算出第一次次品+第二次正品 和  第一次正品和第二次正品的可能性只和，相除即答案；

方法二：就是全概率公式，对于本题，A的概率只有正品和次品之分，故答案为

A2为正品的概率就是 A1为正品的概率的*（在A1为正品的前提下A2为正品的概率） + A1为次品的概率*（在A1为次品的概率下A2为正品的概率）

推广：如果是第三个为正品，那么就是A1A2为正品，A1为正品呢A2为次品，A1为次品A2为正品，A1A2为次品的概率的前提下A3为正品的概率

-------
在全概率公式中，如果将A看成是“结果”，Bi看成是导致结果发生的诸多“原因”之一，那么**全概率公式就是一个“原因推结果”的过程**。

**区别于与此相反的贝叶斯公式**。

贝叶斯公式中，我们是知道结果A已经发生了，所要做的是反过来研究造成结果发生的原因，是XX原因造成的可能性有多大，即“结果推原因”。
-------------

# 贝叶斯公式 Bayes' formula

 $P(B_i|A)=\frac{P(AB_i)}{P(A)}=\frac{P(B_i)P(A|B_i)}{\sum_j P(B_j)P(A|B_j)}$

## 贝叶斯公式与全概率公式

在全概率公式中，如果将A看成是“结果”，Bi看成是导致结果发生的诸多“原因”之一，那么**全概率公式就是一个“原因推结果”的过程**。但贝叶斯公式却恰恰相反。

贝叶斯公式中，我们是知道结果A已经发生了，所要做的是反过来研究造成结果发生的原因，是XX原因造成的可能性有多大，即“结果推原因”。

即大事件A已经发生的条件下，分割中的小事件Bi的概率，设B1,B2,...是样本空间Ω的一个划分，则对任一事件A（P(A)>0),有

$P(B_i|A)=\frac{P(B_i)P(A|B_i)}{\Sigma_{j=1}^nP(B_j)P(A|B_j)}$

上式即为贝叶斯公式，Bi 常被视为导致试验结果A发生的”原因“，P(Bi)(i=1,2,...)表示各种原因发生的可能性大小，故称先验概率；

P(Bi|A)(i=1,2...)则反映当试验产生了结果A之后，再对各种原因概率的新认识，故称后验概率。

### 用Venn图来理解:

随机事件的意思就是，在试验之前你并不知道该事件是否会在试验中发生，发生与否取决于机遇。假设不同特征彼此独立，即，当有 

$P(y|x_1,\cdots,x_n)=\frac{P(y)P(x_1,\cdots,x_n|y)}{P(x_1,\cdots,x_n)}$

假设$P(x_i|y,x_1,\cdots,x_{i-1},x_{i+1},\cdots,x_n)=P(x_i|y)$ [称作“朴素”贝叶斯（Naive Bayes）]

概率密度可以理解为“瞬时”的概率。对于概率密度函数，必须要满足两条性质：

$\begin{array}{l}
(1)\quad f(x) \ge 0;\\
(2)\quad \int_{-\infty}^{\infty}f(x)dx=1
\end{array}$

所以只要f(x)整体的积分为1就可以了，并不要求局部的每个值都比1小。就像δ函数，虽然在0上的函数值可以大于1，但整体的积分却永远是1。

#### 实例：

发报台分别以概率0.6和0.4发出信号“∪”和“—”。由于通信系统受到干扰，当发出信号“∪”时，收报台分别以概率0.8和0.2受到信号“∪”和“—”；又当发出信号“—”时，收报台分别以概率0.9和0.1收到信号“—”和“∪”。求当收报台收到信号“∪”时，发报台确系发出“∪”的概率。

解：设....， P(B1|A）= (0.6*0.8)/(0.6*0.8+0.4*0.1)=0.923

实例: 通过知道一个人的身高、体重以及脚的尺寸，去判断这个人是男是女。

训练数据如下：

| 性别   | 身高（英尺） | 体重（磅） | 脚尺寸（英寸） |
| ---- | ------ | ----- | ------- |
| 男    | 6      | 180   | 12      |
| 男    | 5.92   | 190   | 11      |
| 男    | 5.58   | 170   | 12      |
| 男    | 5.92   | 165   | 10      |
| 女    | 5      | 100   | 6       |
| 女    | 5.5    | 150   | 8       |
| 女    | 5.42   | 130   | 7       |
| 女    | 5.75   | 150   | 9       |

问题：现有一身高6英尺，体重130磅，脚尺寸为8英寸的人，这个人是男是女呢？

先将数据可视化：

```python
from mpl_toolkits.mplot3d import Axes3D
import matplotlib.pyplot as plt

fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')

# 身高、体重、脚尺寸数据
x = [6, 5.92, 5.58, 5.92, 5, 5.5, 5.42, 5.75]
y = [180, 190, 170, 165, 100, 150, 130, 150]
z = [12, 11, 12, 10, 6, 8, 7, 9]

# 男性用红色园圈表示
ax.scatter(x[:4], y[:4], z[:4], c='r', marker='o', s=100)
# 女性用蓝色三角表示
ax.scatter(x[4:], y[4:], z[4:], c='b', marker='^', s=100)

ax.set_xlabel('Height (feet)')
ax.set_ylabel('Weight (lbs)')
ax.set_zlabel('Foot size (inches)')

plt.show()
```

只有8组数据，但我们在图中也大概看了出来，似乎男女的数据点都有种“聚成一团”的感觉....判别...分类...

**这个和贝叶斯能有什么关系呢？**

记F1、F2、F3分别为身高、体重、脚尺寸的随机变量，取值当然是各自坐标轴上的值。再记C为分类结果的随机变量，取值为“男”或“女”。 
要解决的**问题的本质，就是在已知F1、F2、F3的时候，判断p(男|F1,F2,F3)与p(女|F1,F2,F3)究竟哪个更加大**.

换言之，这个人是更像男还是更像女，是： $\hat{c} = \underset{c}{\arg\max} \> p(C|F_1,F_2,F_3)$

根据贝叶斯公式，得 $p(C|F_1,F_2,F_3)=\frac{p(F_1,F_2,F_3|C)P(C)}{p(F_1,F_2,F_3)}$

分母是一个常数，忽略以简化。如何求p(F1,F2,F3|C)P(C)

认定F1、F2、F3是彼此独立的特征,$p(F_1,F_2,F_3|C)=p(F_1|C)p(F_2|C)p(F_3|C)$

$\hat{c} = \underset{c}{\arg\max} \> p(F_1|C)p(F_2|C)p(F_3|C)P(C)$

有一个严重的问题没有解决——连续随机变量。我们不能想离散随机变量那样计算p(Fi|C)。 

然而我们可以假设，身高、体重、脚尺寸都是**正态分布**。 分析一下样本数据的数字特征：

| 性别   | 均值(身高) | 方差(身高)     | 均值(体重) | 方差(体重)     | 均值(脚的尺寸) | 方差(脚的尺寸)   |
| ---- | ------ | ---------- | ------ | ---------- | -------- | ---------- |
| 男性   | 5.855  | 3.5033e-02 | 176.25 | 1.2292e+02 | 11.25    | 9.1667e-01 |
| 女性   | 5.4175 | 9.7225e-02 | 132.5  | 5.5833e+02 | 7.5      | 1.6667e+00 |

得到了均值与方差，也就得到了正态分布的μ与σ2参数。 

如此，$p(F_1|C)p(F_2|C)p(F_3|C)$就能顺利求出了。 

$男p(F_1=6|男)=\frac{1}{\sqrt{2\pi \sigma^2}}\exp \left(\frac{-(6-\mu)^2}{2\sigma^2}\right)\approx 1.5789$

这里求的是连续随机变量的概率密度，所以求出比1大的值也是正常的

剩下的P(C)可以用样本中男女的出现频率来估计，估算出都是0.5。

综上，我们计算可得：

$男男男男p(F_1=6|男)p(F_2=130|男)p(F_3=8|男)P(男)=6.1984\times 10^{-9}$
$女女女女p(F_1=6|女)p(F_2=130|女)p(F_3=8|女)P(女) = 5.3778 \times 10^{-4}$

计算结果可以看出，这个人是女性的可能性远大于是男性的可能性。
